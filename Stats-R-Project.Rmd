---
title: "R Notebook"
author: Jessica Arrouasse and Hadas Neuman
date: 29/04/2020
output: html_document
---
# Final Exercise

## Question 1
Question: **Using the helper function in R, identify the library where your dataset is stored. Install relevant libraries and call your dataset**.
In order to find the source of our dataset, we used the "findFn" function from the sos package:
```{r}
library("sos")
findFn("socsupport")
```
We will install the package "DAAG":
```{r}
install.packages("DAAG")
```
## Question 2
### Section A
Question: **What is the size of your dataset? What do the different variables mean? Write a short description (1 line) per variable. You may rely on any information you can find on the internet or use the helper function in R**.
1. To find the size of the dataset, we will use the dim function:
```{r}
library(DAAG)
attach(socsupport)
dim(socsupport)
```
The socsupport dataset has 95 records with 20 variables.

2. To find the description, we will use the R help operator - ?
```{r}

?socsupport

```
 * gender - a factor with levels female, male
 * age - age, in years, with levels 18-20, 21-24, 25-30, 31-40,40+
 * country - a factor with levels australia, other
 * marital - a factor with levels married, other, single
 * livewith - a factor with levels alone, friends, other, parents, partner, residences
 * employment - a factor with levels employed fulltime, employed part-time, govt assistance, other, parental support
 * firstyr - a factor with levels first year, other
 * enrolment - a factor with levels full-time, part-time, <NA>
 * emotional - summary of 5 questions on emotional support availability
 * emotionalsat - summary of 5 questions on emotional support satisfaction
 * tangible - summary of 4 questions on availability of tangible support
 * tangiblesat - summary of 4 questions on satisfaction with tangible support
 * affect - summary of 3 questions on availability of affectionate support sources
 * affectsat - summary of 3 questions on satisfaction with affectionate support sources
 * psi - summary of 3 questions on availability of positive social interaction
 * psisat - summary of 3 questions on satisfaction with positive social interaction
 * esupport - summary of 4 questions on extent of emotional support sources
 * psupport - summary of 4 questions on extent of practical support sources
 * supsources - summary of 4 questions on extent of social support sources (formerly, socsupport)
 * BDI - Score on the Beck depression index (summary of 21 questions)


### Section B
 Question: **In one table, show the type, the minimum, the maximum, the mean and the median (when relevant) of each variable**.
 To answer this, first we will choose only the columns with numeric values.

```{r}
library(dplyr)
num_socs <- socsupport %>% select_if(is.numeric)
```

Next we will apply the summery function on each variable
```{r}
socs_stat_sum <- sapply(num_socs, summary)
socs_type <- sapply(socsupport, class)
```

The output of the function is a list of vectors. We will convert it to a dataframe and assign the names of the variables to the dataframe rows.
```{r}
socs_sum_df <- bind_rows(lapply(socs_stat_sum, as.data.frame.list))
socs_type_df <- bind_rows(lapply(socs_type, as.data.frame.list))

row.names(socs_sum_df) <- colnames(num_socs)
row.names(socs_type_df) <- colnames(socsupport)
```


We will replace the factor with strings:
```{r}
socs_type_df$X.AsIs. <- as.character(socs_type_df$X.AsIs.)
socs_type_df$X.factor. <- as.character(socs_type_df$X.factor.)
socs_type_df$X.numeric. <- as.character(socs_type_df$X.numeric.)
```

Now we will replace the "NAs" with spaces, and concatenate them to a single variable:
```{r}
socs_type_df[is.na(socs_type_df)] <- ""
socs_type_df$Type = paste0(socs_type_df$X.AsIs., " ", socs_type_df$X.factor., socs_type_df$X.numeric.)
```
We will merge the numerical summary dataframe, and the type dataframe:
```{r}
socs_all_sum_df <- merge(socs_type_df, socs_sum_df, by = "row.names", all = TRUE)
```
Lastly, we will round the "Mean" column and select only the desired fields:
```{r}
socs_all_sum_df$Mean = round(socs_all_sum_df$Mean, digits = 2)
socs_all_sum_df %>% select(Row.names, Type, Min., Max., Mean, Median)

```

### Section C
Question: **What is the average BDI score (depression index) per country? Show your results in a table**.
To answer this, we will group the dataframe by country, and calculate the mean.
```{r}
bdi_comparison <- socsupport %>%
  group_by(country) %>%
  summarise(mean_bdi = mean(BDI, na.rm = T))
```
We will round the result to 2 digits:
```{r}
bdi_comparison$mean_bdi = round(bdi_comparison$mean_bdi, 2)
bdi_comparison
```
### Section D
Question: **Using the table from 1.c., plot the average BDI per country**.
We will use the geom_col of the ggplot package (and convert the country factor to a character-vector).

```{r}
library(ggplot2)
ggplot(data = bdi_comparison, aes(x = as.character(country), y = mean_bdi)) +
  geom_col() +
  ggtitle("Mean BDI per country") +
  xlab("Country") +
  ylab("Mean BDI") +
  theme_classic(base_size = 15)
```
### Section E
Question: **Using a plot, what is the average BDI score per country and per marital status**?  
We will group the dataframe by country and by marital status, and plot a barplot:

```{r}
bdi_comparison_2 <- socsupport %>%
  group_by(country, marital) %>%
  summarise(mean_bdi = mean(BDI, na.rm = T))

ggplot(data = bdi_comparison_2, aes(x = as.character(country), y = mean_bdi, fill = as.character(marital))) +
  geom_col(position = "dodge") +
  ggtitle("Mean BDI per country and merital status") +
  xlab("Country") +
  ylab("Mean BDI") +
  labs(fill = "Marital status") +
theme_classic(base_size = 15)

```
The average BDI scores per country and per marital status are as follow:
For married people from Australia: About 8.5
For single people from Australia: About 12
For people in other situation from Australia: About 7
For married people from other places: About 7.5
For single people from other places: About 13
For people in other situation from other places: About 6

## Question 3
### Section A
Question: **What is the distribution of “emotional” and “emotionalsat”? Show it in a graph. What is the difference between these two variables?**
We will plot a histogram of the two variables( without the NA values):
```{r}
socsupport %>%
  subset(!is.na(emotional)) %>%
  subset(!is.na(emotionalsat)) %>%
  ggplot() +
  geom_histogram(aes(x = emotional, fill = "blue"), binwidth = 1, alpha = 0.4) +
  geom_histogram(aes(x = emotionalsat, fill = "pink"), binwidth = 1, alpha = 0.4) +
  scale_fill_discrete(name = "Variable", labels = c("emotional", "emotionalsat")) +
  ggtitle("Emotional support distribution") +
  xlab("Emotional support availability and satisfaction") +
theme_classic(base_size = 15)

```
To get better impression, we plot the density as well:

```{r}
socsupport %>%
  subset(!is.na(emotional)) %>%
  subset(!is.na(emotionalsat)) %>%
  ggplot() +
  geom_density(aes(x = emotional, fill = "blue"), alpha = 0.4) +
  geom_density(aes(x = emotionalsat, fill = "pink"), alpha = 0.4) +
  scale_fill_discrete(name = "Variable", labels = c("emotional", "emotionalsat")) +
  ggtitle("Emotional support distribution") +
  xlab("Emotional support availability and satisfaction") +
  theme_classic(base_size = 15)
```
It seems that the two variables have similar distribution, with a bit higher pik in the 20 score of the emotionsat variable.
According to the documentaion, the emotional variable represents a summary of 5 questions on emotional support **availability**, while the emotionalsat variable represents a summary of 5 questions on emotional support **satisfaction**.

### Section B
Question: **Using a statistical test of your choice, is there a correlation between scores of emotional satisfaction and affectionate support resources? Explain your method and show your result on a plot of your choice.**
The affectionate support resources are represented by the "affect" variable, and the scores of emotional satisfaction are represented by the emotionalsat variable.
To answer this, we will first test the pearson correlation:
```{r}
cor.test(socsupport$emotionalsat, socsupport$affect, method = "pearson")
```
Since the p-value of the test is 2.185e-09, which is less than the significance level of 0.05, we conclude that the emotional satisfaction and the affectionate support resources are significantly correlated with a correlation coefficient of 0.57 and p-value of 2.185e-09. From that reason we will not test the Spearman correlation.
We will plot the correlation using geom_smooth:
```{r}
ggplot(socsupport, aes(x = emotionalsat, y = affect)) +
  geom_point() +
  geom_smooth(method = lm) +
  ggtitle("Affectionate support as a parameter of emotional satisfaction") +
theme_classic(base_size = 15)
```

### Section C
Question: **Are social people (people with more positive interactions) less likely to be depressed? You must answer this question using an appropriate statistical test.**
We will base our answer on the variables **psi**, which represents a summary of 3 questions on availability of positive social interaction, and **BDI**, which is the score on the Beck depression index (summary of 21 questions).
In order to choose the appropriate test, we will test the type of these two variables:
```{r}
str(socsupport$psi)
str(socsupport$BDI)
```
Since the two variables are quantitative variables, we will use a correlation. We will start with the pearson correlation:
```{r}
cor.test(socsupport$BDI, socsupport$psi, method = "pearson")
```
It seems that there is negative correlation (cor = -0.45) with significant level of 4.281e-06, which is smaller than the significance level of 0.05. We conclude that social people are indeed less likely to be depressed.

### Section D
Question: **Show your results on a plot.**
We will use the geom_smooth again:
```{r}
ggplot(socsupport, aes(x = psi, y = BDI)) +
  geom_point() +
  geom_smooth(method = lm) +
  ggtitle("Depression levels as a parameter of availability of positive social interaction") +
theme_classic(base_size = 15)
```

## Question 4
Question: **Using all the variables at your disposition, write the best model possible to explain depression scores. You can test as many models as you want. In your code, you must show all the formulas you have tried but you must only report the results for the best model. Why did you choose that model over others?**

First we will test the correlation between the variables:
```{r}
library(psych)
pairs.panels(socsupport)

```
We can see that the BDI variable has the highest correlation with the the psi and the psisat variables, which also correlates between them. So our first model will depend on the psi variable:
```{r}
summary(lm(data = socsupport, BDI ~ psi))
```

We can see that the R-squared is low - only 0.2, and the standard error is high. We will try to depend out model on the "psisat" variable:
```{r}
summary(lm(data = socsupport, BDI ~ psisat))
```
And on their combination:

```{r}
summary(lm(data = socsupport, BDI ~ psi + psisat))
```
We can see that the R-squared is still low - only 0.2, and the standard error is still high. We will try to improve the model by replacing the psi with the affectsat variable, which has a correlation of 0.35 with BDI:

```{r}
summary(lm(data = socsupport, BDI ~ psisat + affectsat))
```
We can see that the R-squared decreased. We will try to replace the psisat with the psisat variable:

```{r}
summary(lm(data = socsupport, BDI ~ psi + affectsat))
```
We can see that the Adjusted R-squared got higher, but it is still less than 0.2. So we will replace the affect variable with another variable. We chose next the emotionalsat variable, which represents a summary of 5 questions on emotional support satisfaction and has a negative correlation of 0.33 with BDI.
```{r}
summary(lm(data = socsupport, BDI ~ psi + emotionalsat))

```
We find that the Adjusted R-squared decreased again, and the standard error increased. We replaced the emotional with supsources, which represents a summary of 4 questions on extent of social support sources.
```{r}
summary(lm(data = socsupport, BDI ~ psi + supsources))
```
We find that the Adjusted R-squared increased than last model, but it is still lower than with the psi alone. We replaced the supsourced variable with "tangiblesat", which represents a summary of 4 questions on satisfaction with tangible support:
```{r}
summary(lm(data = socsupport, BDI ~ psi + tangiblesat))
```
We can see that Adjusted R-squared increased a bit, and it is even higher than the first model, in which the R-squared had the value of 2.047. We will try to improve this last model by adding the variable that represent a summary of 5 questions on emotional support availability:
```{r}
summary(lm(data = socsupport, BDI ~ psi + tangiblesat + emotional))
```
We see that the Adjusted R-squared decreased again.
We tried to remove the psi variable and base our model on 2 other variables that correlate with BDI - the affects at and emotional sat variables.
```{r}
summary(lm(data = socsupport, BDI ~ affectsat + emotionalsat))
```
We found that the Adjusted R-squared decreased to 0.12. We chose to stay with the model that is based on the variable "psi", which represents a summary of 3 questions on availability of positive social interaction, and the variable "tangiblesat", which stands for a summary of 4 questions on satisfaction with tangible support:
```{r}
summary(lm(data = socsupport, BDI ~ psi + tangiblesat))
```
Done.

